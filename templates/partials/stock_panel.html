    <!-- Header Info Grid (Multi-row for Rich Data) -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-x-6 gap-y-4 border-b-2 border-[#30363d] pb-6 mb-6">
        <div class="col-span-2">
            <div class="flex items-center gap-2 mb-1">
                <span class="text-[10px] bg-blue-900 text-blue-200 px-1 rounded">{{ stock.market }}</span>
                <span class="text-[10px] text-gray-400">#{{ current_code }}</span>
            </div>
            <h2 id="ticker-code-display" data-stock-code="{{ current_code }}" class="text-xl font-bold text-[#f0f6fc]">{{ stock.name }}</h2>
        </div>
        
        <!-- Price & Change -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">現在値 ({{ stock.time }})</div>
            <div class="text-xl font-bold {{ 'text-red-500' if '+' in stock.change else 'text-green-500' if '-' in stock.change else 'text-white' }}">
                {{ stock.price }}
            </div>
            <div class="text-[10px] {{ 'text-red-500' if '+' in stock.change else 'text-green-500' if '-' in stock.change else 'text-white' }}">
                {{ stock.change }} ({{ stock.change_pct }})
            </div>
        </div>

        <!-- VWAP & Volume -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">VWAP</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.vwap }}</div>
            <div class="text-[10px] text-gray-500 mt-1 uppercase">出来高</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.volume }}</div>
        </div>

        <!-- Margin Balance -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">信用買残</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.margin_buy }}</div>
            <div class="text-[10px] text-gray-500 mt-1 uppercase">信用売残</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.margin_sell }}</div>
        </div>

        <!-- Margin Ratio & Kairi -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">貸借倍率</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.margin_ratio }}</div>
            <div class="text-[10px] text-gray-500 mt-1 uppercase">25日乖離</div>
            <div class="text-md font-semibold {{ 'text-red-400' if '+' in stock.kairi_25 else 'text-green-400' }}">{{ stock.kairi_25 }}</div>
        </div>

        <!-- Yield & Earnings -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">配当利回り</div>
            <div class="text-md font-semibold text-gray-300">{{ stock.yield }}</div>
            <div class="text-[10px] text-gray-500 mt-1 uppercase">75日乖離</div>
            <div class="text-md font-semibold {{ 'text-red-400' if '+' in stock.kairi_75 else 'text-green-400' }}">{{ stock.kairi_75 }}</div>
        </div>

        <!-- Earnings Plan -->
        <div class="border-l border-[#30363d] pl-4">
            <div class="text-[10px] text-gray-500 uppercase">決算発表日</div>
            <div class="text-xs font-semibold text-gray-300 mt-1">{{ stock.earnings_date }}</div>
            <a href="https://finance.yahoo.co.jp/quote/{{ current_code }}.T/bbs" target="_blank" class="block mt-2 text-[10px] bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-center">
                掲示板
            </a>
        </div>
    </div>

    <!-- Layout Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Left Column: Chart & News -->
        <div class="lg:col-span-3 space-y-6">
            <div class="flex justify-between items-center bg-[#161b22] border border-[#30363d] p-2 rounded-lg">
                <div class="flex gap-4 items-center pl-2">
                    <label class="flex items-center gap-2 cursor-pointer group">
                        <input type="checkbox" checked onchange="window.toggleMA()" class="w-3 h-3 accent-blue-500">
                        <span class="text-[10px] font-bold text-gray-400 group-hover:text-white transition">MOVING AVERAGES</span>
                    </label>
                    <div class="flex gap-2 text-[10px] font-bold opacity-60">
                        <span class="text-yellow-400">● MA5</span>
                        <span class="text-pink-400">● MA25</span>
                    </div>
                </div>
                <div class="flex bg-[#0d1117] border border-[#30363d] rounded p-1 gap-1">
                    <button onclick="window.initStockChart('chart-container', 'candle')" class="px-3 py-1 text-[10px] btn-speed">Candle</button>
                    <button onclick="window.initStockChart('chart-container', 'line')" class="px-3 py-1 text-[10px] btn-speed">Line</button>
                    <button onclick="window.initStockChart('chart-container', 'area')" class="px-3 py-1 text-[10px] btn-speed">Area</button>
                </div>
            </div>
            
            <!-- Chart Container -->
            <div id="chart-container" 
                 class="w-full bg-[#161b22] border border-[#30363d] rounded-lg" 
                 style="height: 400px; display: block;">
            </div>

            <div>
                <p class="section-header">LATEST NEWS (KABUTAN)</p>
                <div class="bg-[#161b22] border border-[#30363d] rounded-lg overflow-hidden">
                    {% if news %}
                        {% for item in news %}
                        <div class="p-3 border-b border-[#21262d] last:border-0 hover:bg-[#21262d] transition">
                            <a href="{{ item.url }}" target="_blank" class="text-sm text-[#c9d1d9] hover:text-[#58a6ff] flex justify-between">
                                <span>{{ item.title }}</span>
                                <svg class="w-4 h-4 ml-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                            </a>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="p-6 text-center text-gray-500 text-sm italic">No data available.</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Right: Analysis Links -->
        <div class="space-y-4">
            <p class="section-header">ANALYSIS TOOLS</p>
            <div class="flex flex-col gap-2">
                {% set tools = [
                    ('Nikkei', 'https://www.nikkei.com/nkd/company/chart/?scode=' ~ current_code, 'Smart Chart'),
                    ('Yahoo JP', 'https://finance.yahoo.co.jp/quote/' ~ current_code ~ '.T', 'Stock Details'),
                    ('BBS', 'https://finance.yahoo.co.jp/quote/' ~ current_code ~ '.T/bbs', 'Comments'),
                    ('Karauri', 'https://karauri.net/' ~ current_code ~ '/', 'Short Sell'),
                    ('IR BANK', 'https://irbank.net/' ~ current_code ~ '/', 'Financials'),
                    ('Buffett', 'https://www.buffett-code.com/company/' ~ current_code ~ '/', 'Analysis')
                ] %}
                {% for name, url, desc in tools %}
                    <a href="{{ url }}" target="_blank" class="p-4 bg-[#161b22] border border-[#30363d] rounded-lg hover:border-blue-500 transition group">
                        <div class="font-bold text-[#58a6ff] group-hover:text-blue-400">{{ name }}</div>
                        <div class="text-[10px] text-gray-500 uppercase tracking-wider">{{ desc }}</div>
                    </a>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

